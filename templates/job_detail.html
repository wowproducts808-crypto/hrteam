{% extends "base.html" %}
{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
  
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div style="margin-bottom: 20px;">
    <a href="/jobs" style="color: #007bff; text-decoration: none; font-weight: 600;">‚Üê –ù–∞–∑–∞–¥ –∫ –≤–∞–∫–∞–Ω—Å–∏—è–º</a>
  </div>

  <div style="background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden;">
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–∏ -->
    <div style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 35px;">
      <div style="display: flex; justify-content: space-between; align-items: start;">
        <div>
          <h1 style="margin: 0 0 12px 0; font-size: 32px; font-weight: 700;">{{ job.title }}</h1>
          <div style="font-size: 18px; opacity: 0.95;">
            <span>üè¢ {{ job.employer.name }}</span>
            {% if job.location %}
              <span style="margin-left: 25px;">üìç {{ job.location }}</span>
            {% endif %}
          </div>
        </div>
        
        <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ -->
        <div style="text-align: right;">
          {% if job.status.value == 'open' %}
            <span style="background: rgba(40,167,69,0.9); padding: 12px 20px; border-radius: 25px; font-size: 16px; font-weight: 600;">üü¢ –û—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è –æ—Ç–∫–ª–∏–∫–æ–≤</span>
          {% elif job.status.value == 'paused' %}
            <span style="background: rgba(108,117,125,0.9); padding: 12px 20px; border-radius: 25px; font-size: 16px; font-weight: 600;">‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</span>
          {% elif job.status.value == 'in_progress' %}
            <span style="background: rgba(255,193,7,0.9); color: #333; padding: 12px 20px; border-radius: 25px; font-size: 16px; font-weight: 600;">üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ –æ—Ç–±–æ—Ä–∞</span>
          {% elif job.status.value == 'completed' %}
            <span style="background: rgba(220,53,69,0.9); padding: 12px 20px; border-radius: 25px; font-size: 16px; font-weight: 600;">üî¥ –í–∞–∫–∞–Ω—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞</span>
          {% elif job.status.value == 'archived' %}
            <span style="background: rgba(73,80,87,0.9); padding: 12px 20px; border-radius: 25px; font-size: 16px; font-weight: 600;">üìÅ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∞</span>
          {% endif %}
          
          <!-- –ü—Ä–∏—á–∏–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ -->
          {% if job.status_reason %}
            <div style="margin-top: 8px; background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 12px; font-size: 12px;">
              {{ job.status_reason }}
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div style="padding: 40px;">
      
      <!-- –£–ü–†–û–©–ï–ù–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –û–¢–ö–õ–ò–ö–û–í -->
      <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 35px; border-left: 4px solid #007bff;">
        <h3 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 20px;">üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –æ—Ç–∫–ª–∏–∫–∞–º</h3>
        <div style="display: flex; justify-content: space-between; align-items: center; font-size: 16px;">
          <span style="color: #495057;">
            <strong>üë• –ü–æ–ª—É—á–µ–Ω–æ –æ—Ç–∫–ª–∏–∫–æ–≤:</strong> {{ applications_count or 0 }} –∏–∑ {{ job.max_applications or 3 }}
          </span>
          {% if applications_left > 0 %}
            <span style="color: #28a745; font-weight: 600;">
              ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ –º–µ—Å—Ç: {{ applications_left }}
            </span>
          {% else %}
            <span style="color: #dc3545; font-weight: 600;">
              üö´ –ú–µ—Å—Ç–∞ –∑–∞–Ω—è—Ç—ã
            </span>
          {% endif %}
        </div>
        {% if job.avg_time_to_fill %}
          <div style="margin-top: 10px; color: #6c757d; font-size: 14px;">
            <strong>‚è±Ô∏è –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è:</strong> {{ job.avg_time_to_fill }} –¥–Ω–µ–π
          </div>
        {% endif %}
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–µ—Ç–∫–∞) -->
      <div style="display: grid; grid-template-columns: 3fr 2fr; gap: 40px; margin-bottom: 35px;">
        <div>
          {% if job.short_description %}
            <div style="background: #e8f4fd; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 5px solid #007bff;">
              <p style="margin: 0; font-size: 18px; color: #2980b9; font-weight: 500; line-height: 1.6;">{{ job.short_description }}</p>
            </div>
          {% endif %}
          
          <h3 style="color: #2c3e50; margin-bottom: 25px; font-size: 24px;">üìã –û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h3>
          <div style="color: #495057; line-height: 1.8; margin-bottom: 35px; font-size: 16px;">
            {{ job.description|replace('\n', '<br>')|safe }}
          </div>
        </div>
        
        <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–æ–∫–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; height: fit-content;">
          <h4 style="margin-top: 0; color: #2c3e50; font-size: 20px;">üíº –£—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã</h4>
          
          <div style="margin-bottom: 25px;">
            <strong style="color: #2c3e50; font-size: 16px;">üí∞ –í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ:</strong><br>
            <span style="font-size: 24px; color: #28a745; font-weight: bold;">
              {{ "{:,}".format(job.salary_min) }} - {{ "{:,}".format(job.salary_max) }} {{ job.salary_currency or '—Ç–µ–Ω–≥–µ' }}
            </span>
          </div>
          
          {% if job.employment_type %}
            <div style="margin-bottom: 20px;">
              <strong style="color: #2c3e50;">‚è∞ –¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏:</strong><br>
              <span style="color: #495057;">{{ job.employment_type }}</span>
            </div>
          {% endif %}
          
          {% if job.experience_level %}
            <div style="margin-bottom: 20px;">
              <strong style="color: #2c3e50;">üë®‚Äçüíª –£—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞:</strong><br>
              <span style="color: #495057;">{{ job.experience_level }}</span>
            </div>
          {% endif %}
          
          <div style="margin-bottom: 20px;">
            <strong style="color: #2c3e50;">üìÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞:</strong><br>
            <span style="color: #495057;">{{ job.created_at.strftime('%d.%m.%Y –≤ %H:%M') }}</span>
          </div>
          
          <div style="margin-bottom: 20px;">
            <strong style="color: #2c3e50;">üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤:</strong><br>
            <span style="color: #495057;">{{ job.views_count or 0 }}</span>
          </div>
          
          {% if job.filled_at %}
            <div style="margin-bottom: 20px;">
              <strong style="color: #2c3e50;">üèÅ –ó–∞–∫—Ä—ã—Ç–∞:</strong><br>
              <span style="color: #495057;">{{ job.filled_at.strftime('%d.%m.%Y –≤ %H:%M') }}</span>
            </div>
          {% endif %}
          
          <!-- –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô -->
          <div style="margin-top: 30px;">
            {% if current_user and current_user.user_type.value == 'recruiter' %}
              {% if user_applied %}
                <div style="background: #d4edda; color: #155724; padding: 18px; text-align: center; border-radius: 10px; margin-bottom: 15px; font-weight: 600; font-size: 16px;">
                  ‚úÖ –í—ã —É–∂–µ –æ—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; color: #6c757d; font-size: 14px;">
                  –û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è
                </div>
              {% elif job.status.value == 'paused' %}
                <div style="background: #fff3cd; color: #856404; padding: 18px; text-align: center; border-radius: 10px; margin-bottom: 15px; font-weight: 600; font-size: 16px;">
                  ‚è∏Ô∏è –í–∞–∫–∞–Ω—Å–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
                </div>
              {% elif job.status.value in ['completed', 'archived'] %}
                <div style="background: #f8d7da; color: #721c24; padding: 18px; text-align: center; border-radius: 10px; margin-bottom: 15px; font-weight: 600; font-size: 16px;">
                  üîí –í–∞–∫–∞–Ω—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞
                </div>
              {% elif not can_apply %}
                {% if applications_left == 0 %}
                  <div style="background: #f8d7da; color: #721c24; padding: 18px; text-align: center; border-radius: 10px; margin-bottom: 15px; font-weight: 600; font-size: 16px;">
                    üö´ –í—Å–µ –º–µ—Å—Ç–∞ –∑–∞–Ω—è—Ç—ã
                  </div>
                {% else %}
                  <div style="background: #fff3cd; color: #856404; padding: 18px; text-align: center; border-radius: 10px; margin-bottom: 15px; font-weight: 600; font-size: 16px;">
                    ‚ö†Ô∏è –û—Ç–∫–ª–∏–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                  </div>
                {% endif %}
              {% else %}
                <a href="/jobs/{{ job.id }}/apply" style="display: block; background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 18px; text-align: center; border-radius: 10px; text-decoration: none; font-weight: bold; margin-bottom: 15px; transition: all 0.3s; font-size: 16px;">
                  ‚úã –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é
                </a>
                {% if applications_left > 0 %}
                  <div style="background: #e8f5e8; padding: 12px; border-radius: 8px; text-align: center; color: #28a745; font-size: 13px; font-weight: 600;">
                    üî• –û—Å—Ç–∞–ª–æ—Å—å {{ applications_left }} {% if applications_left == 1 %}–º–µ—Å—Ç–æ{% else %}–º–µ—Å—Ç–∞{% endif %}!
                  </div>
                {% endif %}
              {% endif %}
            {% elif not current_user %}
              <div style="background: #e8f4fd; padding: 18px; text-align: center; border-radius: 10px; margin-bottom: 15px;">
                <div style="color: #2980b9; font-weight: 600; margin-bottom: 10px;">–•–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è?</div>
                <a href="/login" style="background: #007bff; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: 600;">
                  üîê –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
                </a>
              </div>
            {% endif %}
            
            <!-- –ö–Ω–æ–ø–∫–∞ —Å–≤—è–∑–∏ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ -->
            {% if current_user %}
              <a href="/messages/to/{{ job.employer.id }}" style="display: block; background: #007bff; color: white; padding: 15px; text-align: center; border-radius: 8px; text-decoration: none; font-weight: 600; transition: background 0.3s; margin-top: 15px;">
                üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–º
              </a>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è -->
      {% if job.requirements %}
        <div style="margin-bottom: 35px;">
          <h3 style="color: #2c3e50; margin-bottom: 25px; font-size: 24px;">‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∫—Ä—É—Ç–µ—Ä—É</h3>
          <div style="background: #fff3cd; padding: 25px; border-radius: 12px; border-left: 5px solid #ffc107;">
            <div style="color: #856404; line-height: 1.8; font-size: 16px;">
              {{ job.requirements|replace('\n', '<br>')|safe }}
            </div>
          </div>
        </div>
      {% endif %}

      <!-- –ß—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º -->
      {% if job.benefits %}
        <div style="margin-bottom: 35px;">
          <h3 style="color: #2c3e50; margin-bottom: 25px; font-size: 24px;">üéÅ –ß—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º</h3>
          <div style="background: #d4edda; padding: 25px; border-radius: 12px; border-left: 5px solid #28a745;">
            <div style="color: #155724; line-height: 1.8; font-size: 16px;">
              {{ job.benefits|replace('\n', '<br>')|safe }}
            </div>
          </div>
        </div>
      {% endif %}

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ -->
      <div style="border-top: 3px solid #e9ecef; padding-top: 30px;">
        <h3 style="color: #2c3e50; margin-bottom: 25px; font-size: 24px;">üè¢ –û —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ</h3>
        <div style="display: flex; align-items: center; gap: 25px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 25px; border-radius: 12px;">
          <div style="flex: 1;">
            <strong style="font-size: 20px; color: #2c3e50;">{{ job.employer.name }}</strong>
            {% if job.employer.company %}
              <div style="color: #6c757d; margin-top: 8px; font-size: 16px;">{{ job.employer.company }}</div>
            {% endif %}
            {% if job.employer.location %}
              <div style="color: #6c757d; margin-top: 5px; font-size: 14px;">üìç {{ job.employer.location }}</div>
            {% endif %}
            {% if job.employer.experience %}
              <div style="color: #6c757d; margin-top: 8px; font-size: 14px;">
                <strong>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã:</strong> {{ job.employer.experience[:100] }}{% if job.employer.experience|length > 100 %}...{% endif %}
              </div>
            {% endif %}
          </div>
          <div>
            <a href="/recruiter/{{ job.employer.id }}" style="background: #007bff; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">
              üë§ –ü—Ä–æ—Ñ–∏–ª—å
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// –í—Å–ø–ª—ã–≤–∞—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('applied') === 'success') {
  showNotification('success', '‚úÖ –û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', '–í–∞—à –æ—Ç–∫–ª–∏–∫ –ø–æ–ª—É—á–µ–Ω —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–º.');
} else if (urlParams.get('error') === 'max_applications') {
  showNotification('error', 'üö´ –ú–µ—Å—Ç–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!', '–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º –æ—Ç–∫–ª–∏–∫–æ–≤ –Ω–∞ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é.');
} else if (urlParams.get('error') === 'job_not_open') {
  showNotification('warning', '‚è∏Ô∏è –í–∞–∫–∞–Ω—Å–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', '–≠—Ç–∞ –≤–∞–∫–∞–Ω—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –æ—Ç–∫–ª–∏–∫–æ–≤.');
}

function showNotification(type, title, message) {
  const colors = {
    success: { bg: '#d4edda', border: '#c3e6cb', text: '#155724' },
    error: { bg: '#f8d7da', border: '#f5c6cb', text: '#721c24' },
    warning: { bg: '#fff3cd', border: '#ffeaa7', text: '#856404' }
  };
  
  const notification = document.createElement('div');
  notification.innerHTML = `
    <div style="position: fixed; top: 20px; right: 20px; background: ${colors[type].bg}; color: ${colors[type].text}; padding: 20px; border-radius: 10px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); max-width: 400px; z-index: 1000; animation: slideIn 0.3s ease;">
      <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
      <div style="font-size: 14px;">${message}</div>
    </div>
  `;
  document.body.appendChild(notification);
  setTimeout(() => notification.remove(), 5000);
}
</script>

<style>
@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
</style>

{% endblock %}
