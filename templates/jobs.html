{% extends "base.html" %}
{% block content %}
  <h2>üíº –í–∞–∫–∞–Ω—Å–∏–∏</h2>

  {% if current_user and current_user.user_type.value == 'employer' %}
    <div style="margin-bottom: 20px;">
      <a href="/jobs/new" style="background: #007bff; color: white; padding: 10px 15px; border-radius: 5px; text-decoration: none;">+ –°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</a>
    </div>
  {% endif %}

  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <form method="get" action="/jobs" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
      <input type="text" name="q" value="{{ q or '' }}" placeholder="–ü–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π..." style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      <input type="number" name="salary_min" value="{{ salary_min or '' }}" placeholder="–ú–∏–Ω. –∑–∞—Ä–ø–ª–∞—Ç–∞" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      <input type="number" name="salary_max" value="{{ salary_max or '' }}" placeholder="–ú–∞–∫—Å. –∑–∞—Ä–ø–ª–∞—Ç–∞" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      <select name="status" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        <option value="" {% if not status %}selected{% endif %}>–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="open" {% if status == "open" %}selected{% endif %}>üü¢ –û—Ç–∫—Ä—ã—Ç—ã</option>
        <option value="in_progress" {% if status == "in_progress" %}selected{% endif %}>üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
        <option value="completed" {% if status == "completed" %}selected{% endif %}>üî¥ –ó–∞–≤–µ—Ä—à–µ–Ω—ã</option>
        {% if current_user and current_user.user_type.value == 'admin' %}
          <option value="draft" {% if status == "draft" %}selected{% endif %}>üìù –ß–µ—Ä–Ω–æ–≤–∏–∫–∏</option>
          <option value="pending" {% if status == "pending" %}selected{% endif %}>‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</option>
          <option value="rejected" {% if status == "rejected" %}selected{% endif %}>‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω—ã</option>
        {% endif %}
      </select>
      <button type="submit" style="background: #28a745; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;">üîç –ù–∞–π—Ç–∏</button>
    </div>
  </form>

  {% if jobs_with_status %}
    <div style="display: grid; gap: 20px;">
      {% for item in jobs_with_status %}
        {% set job = item.job %}
        {% set user_applied = item.user_applied %}
        {% set applications_count = item.applications_count %}
        {% set applications_left = item.applications_left %}
        {% set can_apply = item.can_apply %}
        
        <div style="border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
          
          <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
            <div>
              <h3 style="margin: 0 0 8px 0; color: #2c3e50;">
                <a href="/jobs/{{ job.id }}" style="text-decoration: none; color: #007bff; font-weight: 600;">{{ job.title }}</a>
              </h3>
              <div style="color: #6c757d; font-size: 14px;">
                <span>üè¢ {{ job.employer.name }}</span>
                {% if job.location %}
                  <span style="margin-left: 15px;">üìç {{ job.location }}</span>
                {% endif %}
                {% if job.employment_type %}
                  <span style="margin-left: 15px;">‚è∞ {{ job.employment_type }}</span>
                {% endif %}
              </div>
            </div>
            
            <!-- –°—Ç–∞—Ç—É—Å –≤–∞–∫–∞–Ω—Å–∏–∏ -->
            {% if job.status.value == 'open' %}
              <span style="background: #28a745; color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">üü¢ –û—Ç–∫—Ä—ã—Ç–∞</span>
            {% elif job.status.value == 'in_progress' %}
              <span style="background: #ffc107; color: #333; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
            {% elif job.status.value == 'completed' %}
              <span style="background: #6c757d; color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">üî¥ –ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
            {% elif job.status.value == 'draft' %}
              <span style="background: #6f42c1; color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">üìù –ß–µ—Ä–Ω–æ–≤–∏–∫</span>
            {% elif job.status.value == 'pending' %}
              <span style="background: #fd7e14; color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</span>
            {% elif job.status.value == 'rejected' %}
              <span style="background: #dc3545; color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–∞</span>
            {% elif job.status.value == 'paused' %}
              <span style="background: #adb5bd; color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</span>
            {% elif job.status.value == 'archived' %}
              <span style="background: #495057; color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">üóÑÔ∏è –ê—Ä—Ö–∏–≤</span>
            {% else %}
              <span style="background: #e9ecef; color: #495057; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; text-transform: uppercase;">{{ job.status.value }}</span>
            {% endif %}
          </div>

          <!-- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ -->
          <p style="margin: 0 0 15px 0; color: #495057; line-height: 1.6;">
            {{ job.short_description or (job.description[:150] + '...' if job.description|length > 150 else job.description) }}
          </p>

          <!-- –ó–∞—Ä–ø–ª–∞—Ç–∞ –∏ –æ–ø—ã—Ç -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div style="display: flex; gap: 15px; color: #6c757d; font-size: 14px; flex-wrap: wrap;">
              {% if job.salary_min and job.salary_max %}
                <span style="background: #e8f4fd; color: #2980b9; padding: 6px 12px; border-radius: 15px; font-weight: 600;">
                  üí∞ {{ "{:,}".format(job.salary_min) }} - {{ "{:,}".format(job.salary_max) }} {{ job.salary_currency or '—Ç–µ–Ω–≥–µ' }}
                </span>
              {% endif %}
              {% if job.experience_level %}
                <span style="background: #e8f6f3; color: #27ae60; padding: 6px 12px; border-radius: 15px; font-weight: 600;">
                  üë®‚Äçüíª {{ job.experience_level }}
                </span>
              {% endif %}
              {% if job.category %}
                <span style="background: #fff3cd; color: #856404; padding: 6px 12px; border-radius: 15px; font-weight: 600;">
                  üè∑Ô∏è {{ job.category }}
                </span>
              {% endif %}
            </div>
            <div style="text-align: right; font-size: 12px; color: #adb5bd;">
              <div>{{ job.created_at.strftime('%d.%m.%Y') }}</div>
              <div>üëÄ {{ job.views_count or 0 }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
            </div>
          </div>

          <!-- –°—á–µ—Ç—á–∏–∫ –æ—Ç–∫–ª–∏–∫–æ–≤ (–£–ü–†–û–©–ï–ù–ù–´–ô) -->
         <!-- –°—á–µ—Ç—á–∏–∫ –æ—Ç–∫–ª–∏–∫–æ–≤ –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ–∫—Ä—É—Ç–µ—Ä–æ–≤ -->
<div style="background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #007bff;">
  <div style="display: flex; justify-content: space-between; align-items: center; font-size: 14px; margin-bottom: 8px;">
    <span style="color: #495057;">
      <strong>üë• –û—Ç–∫–ª–∏–∫–∏:</strong> {{ item.applications_count }} –∏–∑ {{ item.job.max_applications }}
    </span>
    <span style="color: #6c757d;">
      <strong>üéØ –í—ã–±—Ä–∞–Ω–æ —Ä–µ–∫—Ä—É—Ç–µ—Ä–æ–≤:</strong> {{ item.selected_recruiters_count }} –∏–∑ {{ item.max_recruiters }}
    </span>
  </div>
  
  {% if item.selected_recruiters %}
    <div style="background: #d4f0d4; padding: 8px; border-radius: 6px; margin-bottom: 8px;">
      <strong>üèÜ –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ä–µ–∫—Ä—É—Ç–µ—Ä—ã:</strong>
      {% for recruiter in item.selected_recruiters %}
        <span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px;">
          {{ recruiter.name }}
        </span>
      {% endfor %}
    </div>
  {% endif %}
  
  {% if item.job.status.value == 'open' or item.selected_recruiters_count < item.max_recruiters %}
    {% if item.available_recruiter_slots > 0 %}
      <span style="color: #28a745; font-weight: 600;">
        ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ –º–µ—Å—Ç –¥–ª—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–æ–≤: {{ item.available_recruiter_slots }}
      </span>
    {% elif item.selected_recruiters_count >= item.max_recruiters %}
      <span style="color: #dc3545; font-weight: 600;">
        üéâ –í—Å–µ —Ä–µ–∫—Ä—É—Ç–µ—Ä—ã –Ω–∞–π–¥–µ–Ω—ã ({{ item.max_recruiters }}/{{ item.max_recruiters }})
      </span>
    {% endif %}
  {% else %}
    <span style="color: #6c757d; font-weight: 600;">
      ‚è∏Ô∏è –ù–∞–±–æ—Ä —Ä–µ–∫—Ä—É—Ç–µ—Ä–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω
    </span>
  {% endif %}
</div>


          <!-- –î–µ–π—Å—Ç–≤–∏—è -->
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; gap: 10px;">
              <a href="/jobs/{{ job.id }}" style="background: #007bff; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: background 0.3s;" onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007bff'">
                üìÑ –ü–æ–¥—Ä–æ–±–Ω–µ–µ
              </a>
              
              <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê –ö–ù–û–ü–ö–ò –û–¢–ö–õ–ò–ö–ê –° –ü–†–û–í–ï–†–ö–ê–ú–ò .value -->
              {% if current_user and current_user.user_type.value == 'recruiter' %}
                {% if user_applied %}
                  <span style="background: #d4edda; color: #155724; padding: 10px 16px; border-radius: 6px; font-weight: 600;">
                    ‚úÖ –£–∂–µ –æ—Ç–∫–ª–∏–∫–∞–ª–∏—Å—å
                  </span>
                {% elif not can_apply %}
                  {% if applications_left == 0 %}
                    <span style="background: #f8d7da; color: #721c24; padding: 10px 16px; border-radius: 6px; font-weight: 600;">
                      üö´ –ú–µ—Å—Ç–∞ –∑–∞–Ω—è—Ç—ã
                    </span>
                  {% elif job.status.value != 'open' %}
                    <span style="background: #fff3cd; color: #856404; padding: 10px 16px; border-radius: 6px; font-weight: 600;">
                      ‚è∏Ô∏è –í–∞–∫–∞–Ω—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞
                    </span>
                  {% else %}
                    <span style="background: #f8d7da; color: #721c24; padding: 10px 16px; border-radius: 6px; font-weight: 600;">
                      üö´ –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ
                    </span>
                  {% endif %}
                {% else %}
                  <a href="/jobs/{{ job.id }}/apply" style="background: #28a745; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: background 0.3s; animation: pulse 2s infinite;" onmouseover="this.style.background='#218838'" onmouseout="this.style.background='#28a745'">
                    ‚úã –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è
                  </a>
                {% endif %}
              {% elif current_user and current_user.user_type.value == 'employer' and current_user.id == job.employer_id %}
                <a href="/my/jobs" style="background: #17a2b8; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">
                  ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                </a>
              {% endif %}
              
              <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–∫—Ä—É—Ç–µ—Ä–æ–≤ -->
              {% if current_user and current_user.user_type.value == 'recruiter' and job.status.value == 'open' %}
                <a href="/messages/to/{{ job.employer_id }}" style="background: #6f42c1; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; font-weight: 600;">
                  üí¨ –ù–∞–ø–∏—Å–∞—Ç—å
                </a>
              {% endif %}
            </div>
            
            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div style="text-align: right; font-size: 12px; color: #6c757d;">
              {% if job.deadline %}
                <div style="color: #e74c3c; font-weight: 600;">‚è∞ –î–æ {{ job.deadline.strftime('%d.%m.%Y') }}</div>
              {% endif %}
              {% if job.urgency and job.urgency != 'normal' %}
                <div style="color: #dc3545; font-weight: 600;">üî• {{ job.urgency|upper }}</div>
              {% endif %}
            </div>
          </div>
          
          <!-- –¢–µ–≥–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è -->
          {% if job.tags or job.requirements %}
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef;">
              {% if job.requirements %}
                <div style="font-size: 13px; color: #6c757d; margin-bottom: 8px;">
                  <strong>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:</strong> {{ job.requirements[:100] }}{% if job.requirements|length > 100 %}...{% endif %}
                </div>
              {% endif %}
              {% if job.tags %}
                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                  {% for tag in job.tags.split(',')[:5] %}
                    <span style="background: #e9ecef; color: #495057; padding: 2px 8px; border-radius: 12px; font-size: 11px;">
                      #{{ tag.strip() }}
                    </span>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div style="text-align: center; padding: 60px; color: #6c757d;">
      <div style="font-size: 64px; margin-bottom: 20px;">üîç</div>
      <h3>–í–∞–∫–∞–Ω—Å–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
      <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –≤–∞–∫–∞–Ω—Å–∏—é!</p>
      {% if current_user and current_user.user_type.value == 'employer' %}
        <a href="/jobs/new" style="background: #007bff; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; margin-top: 15px; display: inline-block;">
          + –°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
        </a>
      {% endif %}
    </div>
  {% endif %}

  <style>
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  </style>
{% endblock %}
