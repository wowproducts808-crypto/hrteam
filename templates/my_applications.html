{% extends "base.html" %}
{% block content %}

<div style="margin-bottom: 30px;">
  <h2 style="margin: 0 0 10px 0; color: #2c3e50;">üìù –ú–æ–∏ –æ—Ç–∫–ª–∏–∫–∏</h2>
  <p style="color: #6c757d; margin: 0;">–í—Å–µ –≤–∞—à–∏ –æ—Ç–∫–ª–∏–∫–∏ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏–∏ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏</p>
</div>

<!-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –¥–æ—Ö–æ–¥–∞ -->
<div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 15px; margin-bottom: 30px;">
  <div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border-radius: 10px; text-align: center;">
    <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">{{ total_applications }}</div>
    <div style="font-size: 12px; opacity: 0.9;">–í—Å–µ–≥–æ –æ—Ç–∫–ª–∏–∫–æ–≤</div>
  </div>
  <div style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 15px; border-radius: 10px; text-align: center;">
    <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">{{ pending_applications }}</div>
    <div style="font-size: 12px; opacity: 0.9;">–û–∂–∏–¥–∞—é—Ç</div>
  </div>
  <div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px; border-radius: 10px; text-align: center;">
    <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">{{ selected_applications }}</div>
    <div style="font-size: 12px; opacity: 0.9;">–í—ã–±—Ä–∞–Ω—ã</div>
  </div>
  <div style="background: linear-gradient(135deg, #27ae60, #229954); color: white; padding: 15px; border-radius: 10px; text-align: center;">
    <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">{{ working_applications }}</div>
    <div style="font-size: 12px; opacity: 0.9;">–í —Ä–∞–±–æ—Ç–µ</div>
  </div>
  <div style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; padding: 15px; border-radius: 10px; text-align: center;">
    <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">{{ completed_applications }}</div>
    <div style="font-size: 12px; opacity: 0.9;">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
  </div>
  <div style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 15px; border-radius: 10px; text-align: center;">
    <div style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">{{ rejected_applications }}</div>
    <div style="font-size: 12px; opacity: 0.9;">–û—Ç–∫–ª–æ–Ω–µ–Ω–æ</div>
  </div>
  <!-- –ë–ª–æ–∫ —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –¥–æ—Ö–æ–¥–æ–º -->
  <div style="background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; padding: 15px; border-radius: 10px; text-align: center;">
    <div style="font-size: 18px; font-weight: bold; margin-bottom: 2px;">{{ "{:,}".format(total_potential_earnings) }}‚Ç∏</div>
    <div style="font-size: 12px; opacity: 0.9;">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥</div>
  </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
<form method="get" action="/my/applications" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
  <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 15px; align-items: end;">
    <div>
      <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2c3e50;">–°—Ç–∞—Ç—É—Å –æ—Ç–∫–ª–∏–∫–∞</label>
      <select name="status" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
        <option value="" {% if not status %}selected{% endif %}>–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="pending" {% if status == "pending" %}selected{% endif %}>‚è≥ –û–∂–∏–¥–∞—é—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è</option>
        <option value="selected" {% if status == "selected" %}selected{% endif %}>‚úÖ –í—ã–±—Ä–∞–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã</option>
        <option value="working" {% if status == "working" %}selected{% endif %}>üöÄ –í —Ä–∞–±–æ—Ç–µ</option>
        <option value="completed" {% if status == "completed" %}selected{% endif %}>üèÜ –ó–∞–≤–µ—Ä—à–µ–Ω—ã</option>
        <option value="rejected" {% if status == "rejected" %}selected{% endif %}>‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω—ã</option>
      </select>
    </div>
    <div>
      <label style="display: block; font-weight: bold; margin-bottom: 5px; color: #2c3e50;">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
      <select name="order" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
        <option value="desc" {% if order == "desc" %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
        <option value="asc" {% if order == "asc" %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
      </select>
    </div>
    <button type="submit" style="background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold;">
      üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
    </button>
  </div>
</form>

<!-- –°–ø–∏—Å–æ–∫ –æ—Ç–∫–ª–∏–∫–æ–≤ -->
{% if applications %}
  <div style="display: grid; gap: 20px;">
    {% for item in applications %}
      <!-- –ù–∞–∑–Ω–∞—á–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ -->
      {% set application = item['application'] %}
      {% set job = item['job'] %}
      {% set earnings = item['recruiter_earnings'] %}
      
      <div style="border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.08); transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
        
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç–∫–ª–∏–∫–∞ -->
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
          <div>
            <h3 style="margin: 0 0 8px 0; color: #2c3e50;">
              <a href="/jobs/{{ job.id }}" style="text-decoration: none; color: #3498db; font-weight: 600;">
                {{ job.title }}
              </a>
            </h3>
            <div style="color: #6c757d; font-size: 14px;">
              <span>üè¢ {{ job.employer.name }}</span>
              {% if job.location %}
                <span style="margin-left: 15px;">üìç {{ job.location }}</span>
              {% endif %}
              {% if job.employment_type %}
                <span style="margin-left: 15px;">‚è∞ {{ job.employment_type }}</span>
              {% endif %}
            </div>
          </div>
          
          <!-- –°—Ç–∞—Ç—É—Å—ã –æ—Ç–∫–ª–∏–∫–æ–≤ -->
          <div style="text-align: right;">
            {% if application.status.value == 'pending' %}
              <span style="background: #fff3cd; color: #856404; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;">‚è≥ –û–∂–∏–¥–∞–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è</span>
            {% elif application.status.value == 'selected' %}
              <span style="background: #cce5ff; color: #004085; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;">‚úÖ –í—ã–±—Ä–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã</span>
            {% elif application.status.value == 'working' %}
              <span style="background: #d4edda; color: #155724; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;">üöÄ –†–∞–±–æ—Ç–∞—é –Ω–∞–¥ –∑–∞–¥–∞—á–µ–π</span>
            {% elif application.status.value == 'completed' %}
              <span style="background: #d1ecf1; color: #0c5460; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;">üèÜ –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª</span>
            {% elif application.status.value == 'rejected' %}
              <span style="background: #f8d7da; color: #721c24; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω</span>
            {% endif %}
            
            <!-- –°—Ç–∞—Ç—É—Å –≤–∞–∫–∞–Ω—Å–∏–∏ -->
            <div style="margin-top: 8px; font-size: 12px;">
              {% if job.status.value == 'open' %}
                <span style="color: #28a745;">üü¢ –í–∞–∫–∞–Ω—Å–∏—è –æ—Ç–∫—Ä—ã—Ç–∞</span>
              {% elif job.status.value == 'in_progress' %}
                <span style="color: #ffc107;">üü° –í–∞–∫–∞–Ω—Å–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
              {% elif job.status.value == 'completed' %}
                <span style="color: #6c757d;">üî¥ –í–∞–∫–∞–Ω—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞</span>
              {% endif %}
            </div>
          </div>
        </div>


        <!-- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ -->
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #3498db;">
          <p style="margin: 0; color: #495057; line-height: 1.5; font-size: 14px;">
            {{ job.short_description or (job.description[:120] + '...' if job.description|length > 120 else job.description) }}
          </p>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—Ä–ø–ª–∞—Ç–µ –∏ –¥–∞—Ç–∞—Ö -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <div style="display: flex; gap: 15px; align-items: center;">
            <span style="background: #e8f4fd; color: #2980b9; padding: 6px 12px; border-radius: 15px; font-size: 14px; font-weight: 600;">
              üíº {{ "{:,}".format(job.salary_min) }} - {{ "{:,}".format(job.salary_max) }} {{ job.salary_currency or '—Ç–µ–Ω–≥–µ' }}
            </span>
          </div>
          <div style="text-align: right; color: #6c757d; font-size: 13px;">
            <div style="font-weight: 600;">–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:</div>
            <div>{{ application.created_at.strftime('%d.%m.%Y –≤ %H:%M') }}</div>
          </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ -->
        {% if application.status.value == 'selected' %}
          <div style="background: #cce5ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 8px 0; color: #004085;">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–±—Ä–∞–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —ç—Ç–æ–π –≤–∞–∫–∞–Ω—Å–∏–µ–π.</h5>
            <p style="margin: 0; font-size: 14px; color: #004085;">–°–≤—è–∂–∏—Ç–µ—Å—å —Å —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–º –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞.</p>
          </div>
        {% elif application.status.value == 'working' %}
          <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 8px 0; color: #155724;">üöÄ –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞–¥ —ç—Ç–æ–π –≤–∞–∫–∞–Ω—Å–∏–µ–π</h5>
            <p style="margin: 0; font-size: 14px; color: #155724;">–ñ–µ–ª–∞–µ–º —É—Å–ø–µ—Ö–æ–≤ –≤ –ø–æ–∏—Å–∫–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞!</p>
          </div>
        {% elif application.status.value == 'completed' %}
          <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 8px 0; color: #0c5460;">üèÜ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å —É—Å–ø–µ—à–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º!</h5>
            <p style="margin: 0; font-size: 14px; color: #0c5460;">–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã–ª–∏ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é. –û–∂–∏–¥–∞–π—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è.</p>
          </div>
        {% elif application.status.value == 'rejected' %}
          <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h5 style="margin: 0 0 8px 0; color: #721c24;">üòî –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤–∞—à –æ—Ç–∫–ª–∏–∫ –Ω–µ –±—ã–ª –ø—Ä–∏–Ω—è—Ç</h5>
            <p style="margin: 0; font-size: 14px; color: #721c24;">–ù–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ—Å—å! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∏—Å–∫–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã.</p>
          </div>
        {% endif %}

        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; gap: 10px;">
            <a href="/applications/{{ application.id }}" 
               style="background: #3498db; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none;">
               üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –∑–∞—è–≤–∫–µ
            </a>
          </div>
          
          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <div style="color: #6c757d; font-size: 13px; text-align: right;">
            <div>–í–∞–∫–∞–Ω—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞: {{ job.created_at.strftime('%d.%m.%Y') }}</div>
            {% set days_ago = (job.created_at.now() - job.created_at).days %}
            {% if days_ago < 7 %}
              <div style="color: #27ae60; font-weight: 600;">üî• –°–≤–µ–∂–∞—è –≤–∞–∫–∞–Ω—Å–∏—è</div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
  <div style="text-align: center; margin-top: 40px; color: #6c757d; font-size: 14px;">
    –ü–æ–∫–∞–∑–∞–Ω–æ {{ applications|length }} –æ—Ç–∫–ª–∏–∫–æ–≤ –∏–∑ {{ total_applications }}
  </div>

{% else %}
  <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
  <div style="text-align: center; padding: 60px 20px; color: #6c757d;">
    <div style="font-size: 64px; margin-bottom: 20px;">üìù</div>
    <h3 style="margin: 0 0 15px 0; color: #2c3e50;">
      {% if status %}
        –ù–µ—Ç –æ—Ç–∫–ª–∏–∫–æ–≤ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º
      {% else %}
        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫–ª–∏–∫–æ–≤
      {% endif %}
    </h3>
    <p style="margin: 0 0 25px 0; font-size: 16px; line-height: 1.5;">
      {% if status %}
        –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –æ—Ç–∫–ª–∏–∫–∏ –Ω–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏.
      {% else %}
        –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –æ—Ç–∫–ª–∏–∫!
      {% endif %}
    </p>
    <a href="/jobs" style="background: #3498db; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 16px; transition: background 0.3s;" onmouseover="this.style.background='#2980b9'" onmouseout="this.style.background='#3498db'">
      üîç –ù–∞–π—Ç–∏ –≤–∞–∫–∞–Ω—Å–∏–∏
    </a>
  </div>
{% endif %}

{% endblock %}
